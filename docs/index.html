<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Movement-library.js</title>
  <script src="/core/Movement-library.js">import mover from "https://raw.githubusercontent.com/Croc-Prog-github/Movement-library.js/main/core/Movement-library.js?token=GHSAT0AAAAAACKZZYCEPVZ52Y6BSKU472HWZUNME4A";</script>
</head>
<body style="display: flex; flex-direction: column; background: #2b2b2b;">
  <hx style="color: white;font-size: larger;font-family: sans-serif;">
    Details on this library here:
    <a href="https://github.com/Croc-Prog-github/Movement-library.js" style="color: dodgerblue;">
      https://github.com/Croc-Prog-github/Movement-library.js
    </a>
  </hx>
  
  <textarea name="Editor" id="Editor" oninput="Run()" autocomplete="off" style="height: 275px; resize: vertical; font-family: monospace;" spellcheck="false">
const element = document.getElementById('movable');
const mover = new MoverJS(element);
    
mover.achieve.randomXY();
    
mover.achieve.setXY(0, 0)
mover.achieve.idElement('movable2')
    
mover.punteTowardsId('movable2')
mover.glideAtIdElement('movable2', 5);
    
mover.glideAt(0, 0, 5);
mover.glideAt(mover.getRandomX(), mover.getRandomY(), 5)
    
mover.punteInDirection(90);
    
mover.changeX(50);
mover.changeY(50);
  </textarea>
  <div hidden style="background-color: white;width: -webkit-fill-available;height: max-content;resize: vertical;overflow-clip-margin: content-box !important;overflow: clip !important;border-width: 2px;border-style: inset;border-color: initial;border-image: initial;">
    <div id="movable" style="width: 50px; position: relative; height: 50px; background-color: blue;"></div>
    <div id="movable2" style="width: 50px; position: relative; left: 0; top: 0; height: 50px; background-color: red;"></div>
  </div>
  <iframe src="" id="iframe" frameborder="1"></iframe>
  <textarea name="Output" id="Out" rows="7" disabled style="resize: none;">Edit the example for run it: add an Enter or a Space.</textarea>
</body>
</html>

<script>
  document.getElementById('iframe').innerHTML = `
  <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Movement-library.js</title>
</head>
<body>
  <div id="movable" style="width: 50px; position: absolute; height: 50px; background-color: blue;"></div>
  <div id="movable2" style="width: 50px; position: absolute; left: 0; top: 0; height: 50px; background-color: red;"></div>

  <script src="/core/Movement-library.js"></script>
  <script src="/core/example.js"></script>
</body>
</html>`
</script>

<script>
  // Correggere il fetch e ottenere il contenuto del file senza commenti sourceMappingURL
  /*
  fetch('/core/example.js')
  .then(response => response.text())
  .then(scriptContent => {
    // Rimuove le righe che iniziano con //# sourceMappingURL=
    scriptContent = scriptContent.replace(/\/\/# sourceMappingURL=.*$/gm, '');
    document.getElementById('Editor').textContent = scriptContent;
  })
  .catch(error => {
    console.error('Error fetching example script:', error);
  });*/  

  // Reindirizzare l'output console
  (function() {
    var oldLog = console.log;
    console.log = function(message) {
      document.getElementById('Out').value += message + '\n';
      oldLog.apply(console, arguments);
    };
  })();

  function Run() {
    const editorContent = document.getElementById('Editor').value;
    try {
      document.getElementById('Out').value = ''; // Pulisce l'output
      eval(editorContent);
    } catch (error) {
      document.getElementById('Out').value = 'Error: ' + error.message;
    }
  }
</script>

<script>
  class MoverJS {
  constructor(element) {
    this.element = element;
    this.element.style.position = 'relative'; // Imposta position: absolute
  }
    
  achieve = {
    setXY: (x, y) => {
      this.element.style.left = (x+"px");
      this.element.style.top = (y+"px") ;
    },

    randomXY: () => {
      this.achieve.setXY(Math.random() * window.innerWidth, Math.random() * window.innerHeight);
    },

    idElement: (id) => {
      const target = document.getElementById(id);
      if (target) {
        const rect = target.getBoundingClientRect();
        this.achieve.setXY(rect.left + window.scrollX, rect.top + window.scrollY);
      } else {
        console.error("The element with the id: " + id + " doesn't exist.");
      }
    },

    mouseFromEvent: (mouseEvent) => {
      const x = mouseEvent.clientX;
      const y = mouseEvent.clientY;
      this.achieve.setXY(x, y);
    },

    /*mouse: () => {
      const moveToMouse = (event) => {
        const x = event.clientX;
        const y = event.clientY;
        this.achieve.setXY(x, y);
      };
      document.addEventListener('mousemove', moveToMouse, { once: true });
    }*/
  }

  getRandomX() {
    return (Math.random() * window.innerWidth)
  }

  getRandomY() {
    return (Math.random() * window.innerHeight)
  }

  glideAt(x, y, seconds) {
    this.element.style.transition = ("left "+ seconds+"s, top "+seconds+"s"); // Animazione su left e top
    this.achieve.setXY(x, y);
    setTimeout(() => {
      this.element.style.transition = ''; // Rimuove la transizione dopo che è completata
    }, seconds * 1000);
  }

  glideAtIdElement(id, seconds) {
    const target = document.getElementById(id);
    if (target) {
      const rect = target.getBoundingClientRect();
      const startX = parseInt(this.element.style.left) || 0;
      const startY = parseInt(this.element.style.top) || 0;
      const endX = rect.left + window.scrollX;
      const endY = rect.top + window.scrollY;
      const distanceX = endX - startX;
      const distanceY = endY - startY;
      this.element.style.transition = ("left "+ seconds+"s, top "+seconds+"s"); // Animazione su left e top
      this.achieve.setXY(startX + distanceX, startY + distanceY);
      setTimeout(() => {
        this.element.style.transition = ''; // Rimuove la transizione dopo che è completata
      }, seconds * 1000);
    } else {
      console.error("The element with the id: " + id + " doesn't exist.");
    }
  }

  punteInDirection(degrees) {
    this.element.style.transform = ("rotate("+degrees+"deg)");
  }

  punteTowardsId(targetId) {
    const target = document.getElementById(targetId);
    if (target) {
      const rect = target.getBoundingClientRect();
      const elementRect = this.element.getBoundingClientRect();
      const deltaX = rect.left - elementRect.left;
      const deltaY = rect.top - elementRect.top;
      const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);
      this.punteInDirection(angle);
    } else {
      console.error("The element with the id: " + targetId + " doesn't exist.");
    }
  }

  changeX(dx) {
    const currentX = parseInt(this.element.style.left) || 0;
    this.achieve.setXY(currentX + dx, parseInt(this.element.style.top) || 0);
  }

  changeY(dy) {
    const currentY = parseInt(this.element.style.top) || 0;
    this.achieve.setXY(parseInt(this.element.style.left) || 0, currentY + dy);
  }
}
</script>